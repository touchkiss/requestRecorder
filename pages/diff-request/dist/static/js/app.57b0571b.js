(function(){"use strict";var e={2205:function(e,t,s){var r=s(8935),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("main",{staticClass:"main-container"},[s("div",{staticClass:"top"},[s("div",{staticClass:"header"},[s("h1",[e._v(" diffRequest ")]),s("el-switch",{staticStyle:{display:"block"},attrs:{"active-color":"#fff000","inactive-color":"#ff4949","inactive-text":e.recording?"正在录制":"不在录制"},on:{change:e.toggleRecorder},model:{value:e.recording,callback:function(t){e.recording=t},expression:"recording"}})],1)]),s("div",{staticClass:"bottom"},[s("div",{staticClass:"right"},[s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{span:6}},[s("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[s("transition",{attrs:{name:"el-zoom-in-top"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.allRequest.length,expression:"allRequest.length"}],staticClass:"card-header"},[s("h3",[e._v("Request List"),s("i",{staticClass:"el-icon-refresh",on:{click:e.loadFromChrome}},[e._v("重新导入")])]),s("el-row",[s("el-col",{attrs:{span:24}},[s("el-input",{attrs:{type:"text",placeholder:"输入regex过滤"},model:{value:e.urlRegex,callback:function(t){e.urlRegex=t},expression:"urlRegex"}})],1)],1)],1)]),e.allRequest.length?e._e():s("el-empty",{attrs:{description:"请先录制请求"}}),s("transition",{attrs:{name:"el-zoom-in-top"}},[s("el-table",{directives:[{name:"show",rawName:"v-show",value:e.allRequest.length,expression:"allRequest.length"}],staticStyle:{width:"100%"},attrs:{data:e.filteredRequest,"highlight-current-row":"","max-height":e.screenHeight-260+"px"},on:{"current-change":e.handleCurrentChange,"selection-change":e.handleSelectionRequestsChange}},[s("el-table-column",{attrs:{type:"selection",width:"30"}}),s("el-table-column",{attrs:{label:"url","header-align":"center",prop:"requestUrl"}}),s("el-table-column",{attrs:{prop:"method",label:"method",align:"right",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制http请求",placement:"right"}},[s("i",{staticClass:"el-icon-s-order",on:{click:function(s){return e.copyToClipboard(t.row,t.row.host)}}})])]}}])})],1)],1),e.allRequest.length&&e.selectedRequest.length?s("el-row",{staticClass:"mb-4",staticStyle:{"margin-top":"10px"},attrs:{gutter:10}},[s("el-col",{attrs:{span:12,align:"center"}},[s("el-button",{attrs:{type:"danger",round:""},on:{click:e.deleteRequest}},[e._v("删除")])],1),s("el-col",{attrs:{span:12,align:"center"}},[s("el-dropdown",{on:{command:e.exportRequest}},[s("el-button",{attrs:{type:"success",round:""}},[e._v(" 导出"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),s("el-dropdown-menu",[s("el-dropdown-item",{attrs:{command:"http"}},[e._v("http")]),s("el-dropdown-item",{attrs:{command:"postman"}},[e._v("postman")])],1)],1)],1)],1):e._e()],1)],1),s("transition",{attrs:{name:"el-zoom-in-top"}},[s("el-col",{directives:[{name:"show",rawName:"v-show",value:e.allRequest.length,expression:"allRequest.length"}],attrs:{span:18}},[s("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[s("el-row",[s("el-col",{attrs:{span:24}},[s("h3",{attrs:{"text-gray-600":""}},[e._v(" "+e._s(e.curRequest&&e.curRequest.url?e.curRequest.method+":"+e.curRequest.requestUrl:"请在左侧选择要测试的request")+" ")])])],1),s("el-row",{staticClass:"content-row",attrs:{gutter:10}},[s("el-col",{attrs:{span:12}},[s("el-input",{attrs:{type:"text",value:e.curRequest&&e.curRequest.host||"",placeholder:"main host"}})],1),s("el-col",{attrs:{span:12}},[s("el-input",{attrs:{type:"text",placeholder:"compare host"},model:{value:e.compareHost,callback:function(t){e.compareHost=t},expression:"compareHost"}})],1)],1),s("el-row",{staticClass:"content-row"},[s("el-col",{attrs:{span:24,align:"center"}},[s("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[s("el-collapse-item",{attrs:{title:"request headers",name:"1"}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.curRequest&&e.curRequest.headers||[],"max-height":"400"}},[s("el-table-column",{attrs:{width:"200",label:"name","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-input",{attrs:{span:12,type:"text",placeholder:"header name"},model:{value:t.row.name,callback:function(s){e.$set(t.row,"name",s)},expression:"props.row.name"}})]}}])}),s("el-table-column",{attrs:{label:"value","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-input",{attrs:{type:"text",placeholder:"header value"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"props.row.value"}})]}}])})],1)],1),s("el-collapse-item",{attrs:{title:"request body",name:"2"}},[s("el-input",{attrs:{rows:5,type:"textarea",placeholder:"Request Body"},model:{value:e.curRequest.requestBody,callback:function(t){e.$set(e.curRequest,"requestBody",t)},expression:"curRequest.requestBody"}})],1)],1)],1)],1),s("el-row",{staticClass:"content-row"},[s("el-col",{attrs:{span:24,align:"center"}},[e.curRequest&&e.curRequest.url?s("el-button-group",[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制main host的http请求体",placement:"top"}},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.copyToClipboard(e.curRequest,e.curRequest.host)}}},[e._v("main ")])],1),s("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],attrs:{type:"danger",round:""},on:{click:function(t){return e.sendAndCompare(void 0,void 0)}}},[e._v(" 发送 ")]),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制compare host的http请求体",placement:"top"}},[s("el-button",{attrs:{type:"primary",title:"复制compare host的http请求体"},on:{click:function(t){return e.copyToClipboard(e.curRequest,e.compareHost)}}},[e._v(" comp ")])],1)],1):e._e()],1)],1),s("el-row",{staticClass:"content-row"},[s("el-col",{attrs:{span:24}},[e.finishCompare&&!e.showHttp?s("json-diff",{attrs:{jsonSourceLeft:e.leftData,jsonSourceRight:e.rightData}}):e._e(),e.finishCompare||e.showHttp?e._e():s("el-input",{attrs:{value:JSON.stringify(e.curResponseBody,null,2),rows:20,type:"textarea",placeholder:"Response body"}}),e.showHttp?s("el-input",{attrs:{rows:20,type:"textarea",id:"httpText",placeholder:"Response body"},model:{value:e.httpText,callback:function(t){e.httpText=t},expression:"httpText"}}):e._e()],1)],1)],1)],1)],1)],1)],1)])])])},a=[],n=s(278),l=s(6166),i=s.n(l),c=s(4549),u=s.n(c);const h=i().create({timeout:2e4});h.defaults.withCredentials=!0,h.interceptors.request.use((e=>e),(e=>(console.log(e),Promise.reject(e)))),h.interceptors.response.use((e=>e),(e=>(console.log(e),Promise.reject(e))));var d=h,p={name:"App",data(){return{storedRequests:[],allRequest:[],filteredRequest:[],screenWidth:window.clientWidth,screenHeight:window.innerHeight,selectedRequest:[],curRequest:{},compareHost:localStorage.getItem("compareHost")||"",activeNames:["2"],multipleHeadsersRef:{},headersSelected:[],leftData:{},rightData:{},finishCompare:!1,curResponseBody:{},urlRegex:localStorage.getItem("urlRegex")||/[htps]+:\/\/[\S]*/,recording:!1,updateRecording:"",methodFilter:[{text:"GET",value:"GET"},{text:"POST",value:"POST"},{text:"OPTIONS",value:"OPTIONS"},{text:"PUT",value:"PUT"},{text:"DELETE",value:"DELETE"},{text:"PATCH",value:"PATCH"},{text:"HEAD",value:"HEAD"}],showHttp:!1,httpText:"",sending:!1}},components:{JsonDiff:n["default"]},mounted(){const e=this;window.onresize=()=>(()=>{e.screenWidth=window.clientWidth,e.screenHeight=window.innerHeight})(),this.loadFromChrome(),this.updateRecording=setInterval((()=>{chrome.runtime.sendMessage({type:"recordingRequest"},(e=>{this.recording=e.recordingRequest}))}),1e3)},beforeUnmount(){clearInterval(this.updateRecording)},watch:{urlRegex(){this.filteredRequest=this.allRequest.filter((e=>e.url&&e.url.match(this.urlRegex))),localStorage.setItem("urlRegex",this.urlRegex)},compareHost(){localStorage.setItem("compareHost",this.compareHost)}},methods:{copyToClipboard(e,t){let s={...e};s["host"]=t,s["url"]=t+s["requestUrl"],this.httpText=this.constructHttpFileContent([s]),this.showHttp=!0,setTimeout((()=>{let e=document.getElementById("httpText");e.select(),document.execCommand("Copy"),this.$message({message:"已将http请求复制到剪贴板",type:"success"})}),500)},loadFromChrome(){chrome.runtime.sendMessage({type:"loadAllRequest"},(e=>{this.allRequest=e.requests,e.requests.length?this.$message({message:"已重新加载所有请求",type:"success"}):this.$message({message:"没有记录，请先录制请求",type:"success"}),this.filteredRequest=this.allRequest.filter((e=>e.url&&e.url.match(this.urlRegex)))}))},toggleRecorder(){chrome.runtime.sendMessage({type:"toggleRecorder"},(e=>{console.log(e),setTimeout((()=>{this.recording||this.loadFromChrome()}),1e3)}))},regexUrl(e){return e.replace(/[htps]+:\/\/[a-zA-Z0-9-\.]+/g,"")},regexHost(e){let t=e.match(/[htps]+:\/\/[a-zA-Z0-9-\.]+/g);return t?t[0]:""},filterMethod(e,t,s){return e===t["method"]},handleCurrentChange(e){this.curRequest=e||{}},async sendAndCompare(e,t){this.sending=!0,this.showHttp=!1,this.finishCompare=!1;let s="";console.log(123);let r=this.curRequest.headers.filter((e=>"Content-Type"===e.name))[0];s=r?r["value"].match("application/x-www-form-urlencoded")?this.curRequest.requestBody:r["value"].match("application/json")?JSON.parse(this.curRequest.requestBody):this.curRequest.requestBody:"",console.log(s);let o={};this.curRequest.headers.forEach((e=>{o[e.name]=e.value})),await d({method:this.curRequest.method.toLowerCase(),url:(t||this.curRequest.host)+(this.curRequest.requestUrl||""),data:s,headers:o}).then((t=>{console.log(t),200===t.status&&(e?(this.leftData=e,this.rightData=t.data,this.finishCompare=!0,this.sending=!1,console.log("compare complete,preResponse:",e,",curResponse:",t.data)):this.compareHost&&""!==this.compareHost?(console.log("compare host",this.compareHost),this.sendAndCompare(t.data,this.compareHost)):(console.log("无compareHost"),this.finishCompare=!1,this.curResponseBody=t.data,this.sending=!1))})).catch((e=>{this.$notify.error({title:"发送请求错误",message:"url:"+(t||this.curRequest.host)+this.curRequest.requestUrl}),console.error(e),this.sending=!1}))},handleSelectionRequestsChange(e){this.selectedRequest=e},deleteRequest(){this.selectedRequest&&this.selectedRequest.length&&(this.selectedRequest.forEach((e=>{this.allRequest.forEach((t=>{t.uuid===e.uuid&&this.allRequest.splice(this.allRequest.indexOf(t),1)}))})),this.filteredRequest=this.allRequest.filter((e=>e.url&&e.url.match(this.urlRegex))),chrome.runtime.sendMessage({type:"setRequests",requests:this.allRequest},(e=>{})),this.$message({message:"删除成功",type:"success"}))},exportRequest(e){this.exportRequests(this.selectedRequest,e)},handleSelectionHeadersChange(e){this.headersSelected.value=e,console.log("handleSelectionHeadersChange",this.headersSelected)},formatDate(e){let t=e.getFullYear()+"-",s=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",r=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",o=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",a=(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":",n=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return t+s+r+o+a+n},exportRequests(e,t){let s=e.length+"个webRequest导出-"+this.formatDate(new Date);switch(t){case"http":this.downloadFile(this.constructHttpFileContent(e),s+".http","utf-8");break;case"postman":this.downloadFile(this.constructPostmanExportContent(!1,e),s+".json","utf-8");break}},downloadFile(e,t,s){let r=document.createElement("a");r.setAttribute("href",`data:text/plain;charset=${s||"utf-8"},${e}`),r.setAttribute("download",t),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)},constructHttpFileContent(e){return e.map((e=>`${e.method.toUpperCase()} ${e.url}\n${e.headers.map((e=>e.name+":"+e.value)).join("\n")}\n\n${e.requestBody}`)).join("\n\n%23%23%23\n")},constructPostmanExportContent(e){let t={info:{schema:"https://schema.getpostman.com/json/collection/v2.0.0/collection.json"},item:[]};return e.forEach((e=>{t["item"].push({name:e.url,request:{url:e.url,method:e.method.toUpperCase(),header:e.headers.map((e=>({key:e.name,value:e.value,type:"text"}))),body:{mode:"raw",raw:e.requestBody}}})})),JSON.stringify(t)}}},m=p,g=s(3736),f=(0,g.Z)(m,o,a,!1,null,null,null),R=f.exports;r["default"].config.productionTip=!1,r["default"].use(u()),new r["default"]({render:e=>e(R)}).$mount("#app")}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,r,o,a){if(!r){var n=1/0;for(u=0;u<e.length;u++){r=e[u][0],o=e[u][1],a=e[u][2];for(var l=!0,i=0;i<r.length;i++)(!1&a||n>=a)&&Object.keys(s.O).every((function(e){return s.O[e](r[i])}))?r.splice(i--,1):(l=!1,a<n&&(n=a));if(l){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,o,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var o,a,n=r[0],l=r[1],i=r[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(o in l)s.o(l,o)&&(s.m[o]=l[o]);if(i)var u=i(s)}for(t&&t(r);c<n.length;c++)a=n[c],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(u)},r=self["webpackChunkdiff_request"]=self["webpackChunkdiff_request"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[998],(function(){return s(2205)}));r=s.O(r)})();
//# sourceMappingURL=app.57b0571b.js.map